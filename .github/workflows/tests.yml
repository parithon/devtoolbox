name: Tests

on:
  push:
    branches:
    - actions-tests

jobs:
  Test-ModuleManifest:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [windows-latest]
        shell: [powershell,pwsh]

    steps:
    - uses: actions/checkout@v1
    - name: Test-ModuleManifest
      shell: ${{ matrix.shell }}
      run: |
        Test-ModuleManifest ./src/devtoolbox.psd1

  Invoke-Pester:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v1
    - name: Bootstrap Powershell
      shell: powershell
      run: |
        & ./_build/bootstrap.ps1
    - name: Invoke-Pester
      shell: powershell
      run: |
        Invoke-Pester -OutputFile TestResults.xml -OutputFormat NUnitXml
    - uses: actions/upload-artifact/@v1
      with:
        name: Test Results
        path: ./TestResults.Xml
